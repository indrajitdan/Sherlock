angular.module("SherlockApp",["ngResource","ngMaterial","ngMessages","LocalStorageModule","ui.router","ngSanitize","ngCsv"]).config(function(a){a.setStorageCookie(1,"/")}).config(function(a){}).config(function(a){a.icon("kelock","./mimg/ke_lock.svg",32).icon("loguser","./mimg/user.svg",32).icon("passkey","./mimg/pas_key4.svg",32).icon("unlock","./mimg/unlock2.svg",32).icon("smartphone","./mimg/smart-phone.svg",32).icon("emailmsg","./mimg/email_msg.svg",32).icon("zipcode","./mimg/place.svg",32).icon("moreshow","./mimg/more2.svg",32).icon("useradd","./mimg/user-add.svg",32).icon("plussign","./mimg/plus_sign.svg",32).icon("refresh","./mimg/refresh1.svg",32).icon("cancelbtn","./mimg/cancel_btn.svg",32).icon("refresh","./mimg/refresh1.svg",32).icon("menuitem","./mimg/th-menu.svg",32).icon("logout","./mimg/power_btn2.svg",32).icon("login","./mimg/login2.svg",32).icon("networkip","./mimg/network_server.svg",32).icon("blocklist","./mimg/block.svg",32)}).run(function(a,b){var c=["./mimg/ke_lock.svg","./mimg/user.svg","./mimg/pas_key4.svg","./mimg/unlock2.svg","./mimg/email_msg.svg","./mimg/place.svg","./mimg/more2.svg","./mimg/user-add.svg","./mimg/plus_sign.svg","./mimg/cancel_btn.svg","./mimg/refresh1.svg","./mimg/th-menu.svg","./mimg/power_btn2.svg","./mimg/login2.svg","./mimg/network_server.svg","./mimg/block.svg"];angular.forEach(c,function(c){a.get(c,{cache:b})})}).factory("SherlockDataService",["$resource",function(a){return{SuppressionListData:a("/sherlockservice/api/sherlock/SuppressionListData",{pkey:"@pkey"},{query:{method:"GET",params:{}}}),AddSuppression:a("/sherlockservice/api/sherlock/SuppressionAddData",{data:"@data"},{query:{method:"GET",params:{}}}),loginCheck:a("/sherlockservice/api/sherlock/authenticateuser",{uname:"@uname",pwd:"@pwd"},{query:{method:"GET",params:{}}}),logoutSherlock:a("/sherlockservice/api/sherlock/logoutsherlock",{pkey:"@pkey"},{query:{method:"GET",params:{}}})}}]).service("SuppressionListService",function(a){this.suppressions=[],this.loadSuppressions=function(){var b=this;a.SuppressionListData.query({pkey:"a"}).$promise.then(function(a){console.log(a.allSuppression),angular.copy(a.allSuppression,b.suppressions),b.errorCondition=!1},function(a){b.suppressions.length=0,b.errorCondition=!0})}}).factory("SuppressionListBroadcast",function(a,b){var c={};return c.suppressions=[],c.refreshSuppressionList=function(){c.suppressions=b.loadSuppressions(),c.broadcastItem()},c.broadcastItem=function(){a.$broadcast("handleSuppressionBroadcast")},c}).config(["$locationProvider",function(a){}]).config(function(a,b){b.otherwise("/home"),a.state("home",{url:"/home",controller:"HomeController as homeCtrl",templateUrl:"./partials/_Home.html"}).state("suppressions",{url:"/suppressions",controller:"SuppressionController as supCtrl",templateUrl:"./partials/_Suppression.html"}).state("addsuppressions",{url:"/addsuppressions",controller:"SuppressionController as supCtrl",templateUrl:"./partials/_AddSuppression.html"})}).controller("SherlockCtrl",function(a,b,c,d,e,f,g,h,i){function j(a){return function(){return d(a).toggle()}}var k=this;k.insuppression=!1,a.$on("$stateChangeSuccess",function(a,b,c,d,e){console.log(b),"suppressions"==b.name?k.insuppression=!0:k.insuppression=!1}),k.refreshSuppression=function(){h.refreshSuppressionList()},k.templateUrlToolbar="partials/_ToolbarButton.html",k.startInitialFns=function(){k.showLogin()};var l=function(){return i.get("loginscs")},m=function(){return i.remove("loginscs")};k.loginSuccess=!0;var n=function(){var a=l();return void 0==a||""==a?(console.log("f"),k.loginSuccess=!1,!1):(console.log("s"),k.loginSuccess=!0,!0)};k.logOut=function(){g.logoutSherlock.query({pkey:l()}).$promise.then(function(a){console.log(a)}),m(),k.loginSuccess=!1,k.showLogin()},k.showLogin=function(){n()?k.loginSuccess=!0:e.show({parent:angular.element(document.body),controller:"DialogController as dlgctrl",templateUrl:"partials/_Login.html"}).then(function(a){k.loginSuccess=a},function(){k.loginSuccess=!0})},k.toggleLeft=j("left"),k.close=function(){d("left").close()},k.addNewSuppression=function(){b.go("addsuppressions")}}).controller("HomeController",function(){}).directive("sherlockDrill",function(){return{template:"<svg></svg>",restrict:"E",link:function(a,b,c){function d(a){var b=t;void 0!=a?(b=k(a),d3.select(".header").text("Mortgage â†’ "+a)):d3.select(".header").text("Mortgage");var c=z.selectAll(".gradient").data(b,function(a){return a.cat});c.enter().append("svg:radialGradient").attr("id",function(a,b){return"gradient"+a.cat}).attr("class","gradient").attr("xlink:href","#master"),c.append("svg:stop").attr("offset","0%").attr("stop-color",g),c.append("svg:stop").attr("offset","90%").attr("stop-color",g),c.append("svg:stop").attr("offset","100%").attr("stop-color",h);var i=A.selectAll("path").data(p(b),function(a){return a.data.cat});i.enter().append("svg:path").attr("class","sector"),i.attr("fill",function(a,b){return"url(#gradient"+a.data.cat+")"}).transition().duration(1e3).attrTween("d",f).each("end",function(){this._listenToEvents=!0}),i.on("click",function(a){this._listenToEvents&&(d3.select(this).attr("transform","translate(0,0)"),i.each(function(){this._listenToEvents=!1}),d(a.data.children?a.data.cat:void 0))}).on("mouseover",function(a){if(this._listenToEvents){var b=a.startAngle+(a.endAngle-a.startAngle)/2;b=-1*(b-Math.PI/2);var c=Math.cos(b)*o*.1,d=Math.sin(b)*o*-.1;d3.select(this).transition().duration(250).attr("transform","translate("+c+","+d+")")}}).on("mouseout",function(a){this._listenToEvents&&d3.select(this).transition().duration(150).attr("transform","translate(0,0)")}),i.exit().transition().duration(1e3).attrTween("d",e).remove()}function e(a){a.startAngle=a.endAngle=2*Math.PI;var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return q(b(a))}}function f(a){var b=d3.interpolate({startAngle:0,endAngle:0},a);return this._current=b(0),function(a){return q(b(a))}}function g(a,b){return a.color}function h(a,b){return d3.rgb(g(a,b)).darker()}function k(a){for(i=-1;i++<t.length-1;)if(t[i].cat==a)return t[i].children;return t}var l=500,m=400,n=50,o=Math.min(l-n,m-n)/2,p=d3.layout.pie().sort(null).value(function(a){return a.val}),q=d3.svg.arc().outerRadius(o),r=15,s=d3.scale.category20(),t=[],u=Math.ceil(Math.random()*r);for(i=-1;i++<u;){var v=[],w=Math.ceil(Math.random()*r),x=s(i);for(j=-1;j++<w;)v.push({cat:"loan"+(100*(i+1)+j),val:Math.random(),color:d3.rgb(x).darker(1/(j+1))});t.push({cat:"loan"+i,val:Math.random(),color:x,children:v})}var y=d3.select(b.find("svg")[0]).attr("width",l).attr("height",m),z=y.append("svg:defs"),A=(z.append("svg:radialGradient").attr("gradientUnits","userSpaceOnUse").attr("cx",0).attr("cy",0).attr("r",o).attr("fx",0).attr("fy",0).attr("id","master"),y.append("svg:g").attr("class","arcGroup").attr("filter","url(#shadow)").attr("transform","translate("+l/2+","+m/2+")")),B=(y.append("text").text("Mortgage").attr("transform","translate(10, 20)").attr("class","header"),z.append("filter").attr("id","shadow").attr("filterUnits","userSpaceOnUse").attr("x",-1*(l/2)).attr("y",-1*(m/2)).attr("width",l).attr("height",m));B.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation","4").attr("result","blur"),B.append("feOffset").attr("in","blur").attr("dx","4").attr("dy","4").attr("result","offsetBlur"),B.append("feBlend").attr("in","SourceGraphic").attr("in2","offsetBlur").attr("mode","normal"),d()}}}).directive("sherlockProduct",function(){return{template:"<svg></svg>",restrict:"E",link:function(a,b,c){function d(a){var b=m.nodes(f).reverse(),c=m.links(b);b.forEach(function(a){a.y=180*a.depth});var d=o.selectAll("g.node").data(b,function(a){return a.id||(a.id=++k)}),g=d.enter().append("g").attr("class","node").attr("transform",function(b){return"translate("+a.y0+","+a.x0+")"}).on("click",e);g.append("circle").attr("r",1e-6).style("fill",function(a){return a._children?"lightsteelblue":"#fff"}).append("svg:title").text(function(a){return a.Role}),g.append("text").attr("x",function(a){return a.children||a._children?-13:13}).attr("dy",".35em").attr("text-anchor",function(a){return a.children||a._children?"end":"start"}).text(function(a){return a.name}).style("fill-opacity",1e-6);var h=d.transition().duration(l).attr("transform",function(a){return"translate("+a.y+","+a.x+")"});h.select("circle").attr("r",10).style("fill",function(a){return a._children?"lightsteelblue":"#fff"}),h.select("text").style("fill-opacity",1);var i=d.exit().transition().duration(l).attr("transform",function(b){return"translate("+a.y+","+a.x+")"}).remove();i.select("circle").attr("r",1e-6),i.select("text").style("fill-opacity",1e-6);var j=o.selectAll("path.link").data(c,function(a){return a.target.id});j.enter().insert("path","g").attr("class","link").attr("d",function(b){var c={x:a.x0,y:a.y0};return n({source:c,target:c})}),j.transition().duration(l).attr("d",n),j.exit().transition().duration(l).attr("d",function(b){var c={x:a.x,y:a.y};return n({source:c,target:c})}).remove(),b.forEach(function(a){a.x0=a.x,a.y0=a.y})}function e(a){a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null),d(a)}var f,g=[{name:"Products",parent:"null",_children:[{name:"Insurance",parent:"Products",_children:[{name:"Heath",parent:"Insurance"},{name:"Life",parent:"Insurance"},{name:"Travel",parent:"Insurance"}]},{name:"Mortgage",parent:"Products",_children:[{name:"Mortgage1",parent:"Mortgage"},{name:"Mortgage2",parent:"Mortgage",_children:[{name:"Mortgage2-1",parent:"Mortgage2"},{name:"Mortgage2-2",parent:"Mortgage2"}]}]},{name:"Loan",parent:"Products",_children:[{name:"Loan1",parent:"Loan"},{name:"Loan2",parent:"Loan"}]}]}],h={top:5,right:5,bottom:5,left:100},i=500-h.right-h.left,j=350-h.top-h.bottom,k=0,l=750,m=d3.layout.tree().size([j,1.4*i]),n=d3.svg.diagonal().projection(function(a){return[a.y,a.x]}),o=d3.select(b.find("svg")[0]).attr("width","100%").attr("height","100%").attr("viewBox","0 0 800 800").attr("preserveAspectRatio","xMinYMin").append("g").attr("transform","translate("+h.left+","+h.top+")");f=g[0],f.x0=j/2,f.y0=0,d(f),d3.select(self.frameElement).style("height","500px")}}}).controller("SuppressionController",function(a,b,c,d,e,f,g){this.supList={},this.initialFns=function(){b.loadSuppressions(),this.allrecords=b.suppressions},this.getHeader=function(){return["A","B"]},this.addNew=function(){g.go("addsuppressions")},this.cancelSuppression=function(){g.go("suppressions")};var h={bottom:!0,top:!1,left:!0,right:!0},i=function(){return Object.keys(h).filter(function(a){return h[a]}).join(" ")},j=function(){e.show(e.simple().content("One user added!").position(i()).hideDelay(5e3)),console.log("s")};this.addSuppression=function(a){this.supList=angular.copy(a),console.log(this.supList),c.AddSuppression.query({data:this.supList}).$promise.then(function(a){g.go("suppressions"),b.loadSuppressions(),j(),this.allrecords=b.suppressions}),this.clickedAddNew=!1},this.clearSuppression=function(a){},a.$on("handleSuppressionBroadcast",function(){this.allrecords=d.suppressions})}).run(function(a){}).controller("DialogController",function(a,b,c){var d=this;d.hide=function(){a.hide()},d.cancel=function(){a.cancel()},d.loginFailureMsg=!1,d.nouid=!1,d.nopwd=!1,d.checkLogin=function(){var e=!0;void 0!=d.user?((void 0==d.user.uid||""==d.user.uid)&&(d.nouid=!0,e=!1),(void 0==d.user.upwd||""==d.user.upwd)&&(d.nopwd=!0,e=!1),e&&b.loginCheck.query({uname:d.user.uid,pwd:d.user.upwd}).$promise.then(function(b){var e=[];console.log(b),e=b,"notauthenticated"!=e.publicKey?(c.set("loginscs",e.publicKey),a.hide(!0)):d.loginFailureMsg=!0})):(d.nouid=!0,d.nopwd=!0)}});